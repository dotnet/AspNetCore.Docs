---
title: How to use OpenAPI with minimal APIs
author: rick-anderson
description: Learn how to use OpenApi (Swagger and Swashbuckle) features of minimal APIs in ASP.NET Core.
ms.author: riande
monikerRange: '>= aspnetcore-6.0'
ms.date: 08/23/2022
uid: fundamentals/minimal-apis/openapi
---

# OpenAPI support in minimal APIs - ASP.NET Core

:::moniker range="= aspnetcore-6.0"

An app can describe the [OpenAPI specification](https://swagger.io/specification/) for route handlers using [Swashbuckle](https://www.nuget.org/packages/Swashbuckle.AspNetCore/).

The following code is a typical ASP.NET Core app with OpenAPI support:

[!code-csharp[](samples/WebMinAPIs/Program.cs?name=snippet_swag)]

### Exclude Open API description

In the following sample, the `/skipme` endpoint is excluded from generating an OpenAPI description:

[!code-csharp[](samples/WebMinAPIs/Program.cs?name=snippet_swag2)]

### Describe response types

The following example uses the built-in result types to customize the response:

[!code-csharp[](samples/todo/Program.cs?name=snippet_getCustom)]

### Add operation ids to Open API

[!code-csharp[](samples/todo/Program.cs?name=snippet_name)]

### Add tags to the Open API description

The following code uses an [OpenAPI grouping tag](https://swagger.io/docs/specification/grouping-operations-with-tags/):

[!code-csharp[](samples/todo/Program.cs?name=snippet_grp)]

:::moniker-end

:::moniker range=">= aspnetcore-7.0"

The [OpenAPI specification](https://spec.openapis.org/oas/latest.html)) is a programming language-agnostic standard for documenting HTTP APIs. This standard is supported in minimal APIs through a combination of built-in APIs and open-source libraries. There are three key aspects to OpenAPI integration in an application:

* Generating information about the endpoints in the app.
* Gathering the information into a format that matches the OpenAPI schema.
* Exposing the generated OpenAPI schema via a visual UI or a serialized file.

Minimal APIs provides built-in support for generating information about endpoints in an app via the `Microsoft.AspNetCore.OpenApi` package. Exposing the generated OpenAPI definition via a visual UI requires a third-party package. 

The following code is generated by the ASP.NET Core minimal web API template and uses OpenAPI:

[!code-csharp[](7.0-samples/WebMinOpenApi/Program.cs?name=snippet&highlight=1,5-6,12-13,35-36)]

In the preceding highlighted code:

* `Microsoft.AspNetCore.OpenApi` is explained in the next section.
* <xref:Microsoft.Extensions.DependencyInjection.EndpointMetadataApiExplorerServiceCollectionExtensions.AddEndpointsApiExplorer%2A> : Configures the app to use the API Explorer to discover and describe endpoints with default annotations. `WithOpenApi` overrides matching, default annotations generated by the API Explorer with those produced from the `Microsoft.AspNetCore.OpenApi` package.
* `UseSwagger`adds the [Swagger middleware](xref:tutorials/get-started-with-swashbuckle#add-and-configure-swagger-middleware).
* `UseSwaggerUI` enables the [Static File Middleware](xref:fundamentals/static-files).
* <xref:Microsoft.AspNetCore.Builder.RoutingEndpointConventionBuilderExtensions.WithName%2A>: The <xref:Microsoft.AspNetCore.Routing.IEndpointNameMetadata> on the endpoint is used for link generation and is treated as the operation ID in the given endpoint's OpenAPI specification.
* [WithOpenApi](/dotnet/api/microsoft.aspnetcore.builder.openapiendpointconventionbuilderextensions.withopenapi) is explained later in this article.

<a name="openapinuget"></a>

### `Microsoft.AspNetCore.OpenApi` NuGet package

ASP.NET Core provides the [`Microsoft.AspNetCore.OpenApi`](https://www.nuget.org/packages/Microsoft.AspNetCore.OpenApi/) package to interact with OpenAPI specifications for endpoints. The package acts as a link between the OpenAPI models that are defined in the `Microsoft.AspNetCore.OpenApi` package and the endpoints that are defined in Minimal APIs. The package provides an API that examines an endpoint's parameters, responses, and metadata to construct an OpenAPI annotation type that is used to describe an endpoint.

`Microsoft.AspNetCore.OpenApi` is added as a PackageReference to a project file:

[!code-xml[](7.0-samples/WebMinOpenApi/projectFile.xml?highlight=10)]

When using [`Swashbuckle.AspNetCore`](https://www.nuget.org/packages/Swashbuckle.AspNetCore/) with `Microsoft.AspNetCore.OpenApi`, `Swashbuckle.AspNetCore` 6.3.1 and later must be used. Version 6.4.0 or later is required if you want to [provide endpoint summary or description text](#add-endpoint-summary-or-description).

### Add OpenAPI annotations to endpoints via `WithOpenApi`

Calling [WithOpenApi](/dotnet/api/microsoft.aspnetcore.builder.openapiendpointconventionbuilderextensions.withopenapi) on the endpoint to the endpoints metadata. This metadata can be:

* Consumed in third-party packages like [Swashbuckle.AspNetCore](https://www.nuget.org/packages/Swashbuckle.AspNetCore/).
* Displayed in the Swagger user interface or in YAML or JSON generated to define the file.

[!code-csharp[](7.0-samples/todo/Program.cs?name=snippet_withopenapi&highlight=9)]

#### Modify the OpenAPI annotation in `WithOpenApi`

The [WithOpenApi](/dotnet/api/microsoft.aspnetcore.builder.openapiendpointconventionbuilderextensions.withopenapi) method accepts a function that can be used to directly modify the OpenAPI annotation. For example, in the following code, a description is added to the first parameter of the endpoint:

[!code-csharp[](7.0-samples/todo/Program.cs?name=snippet_withopenapi2&highlight=9-99)]

### Add operation IDs to Open API

Operation IDs are used to uniquely identify a given endpoint in OpenAPI. The [`WithName`](/dotnet/api/microsoft.aspnetcore.builder.routingendpointconventionbuilderextensions.withname) extension method can be used to set the operation ID used for a method.

[!code-csharp[](samples/todo/Program.cs?name=snippet_name)]

Alternatively, the `OperationId` property can be set directly on the OpenApi annotation.

```csharp
app.MapGet("/todos", async (TodoDb db) => await db.Todos.ToListAsync())
    .WithOpenApi(operation => new(operation)
    {
        OperationId = "GetTodos"
    });
```

### Add tags to the Open API description

OpenAPI supports using [tag objects](https://swagger.io/docs/specification/grouping-operations-with-tags/) to categorize operations. These tags are typically used to group operations in the Swagger UI. These tags can be added to an operation by invoking the [WithTags](/dotnet/api/microsoft.aspnetcore.http.openapiroutehandlerbuilderextensions.withtags) extension method on the endpoint with the desired tags.

[!code-csharp[](samples/todo/Program.cs?name=snippet_grp)]

Alternatively, the list of `OpenApiTags` can be set on the OpenAPI annotation via the `WithOpenApi` extension method.

```csharp
app.MapGet("/todos", async (TodoDb db) => await db.Todos.ToListAsync())
    .WithOpenApi(operation => new(operation)
    {
        Tags = new List<OpenApiTag>() { new() { Name = "Todos" } }
    });
```

### Add endpoint summary or description

The following highlighted code provides summary and description text for OpenAPI spec generation. You can call extension methods or use attributes:

:::code language="csharp" source="endpoint-description-summary/7.0-samples/OpenAPISummary/Program.cs" id="summary_and_description" highlight="13-14":::

:::code language="csharp" source="endpoint-description-summary/7.0-samples/OpenAPISummary/Program.cs" id="summary_and_description2" highlight="2-3":::

Alternatively, the summaries can be set directly on the OpenAPI annotation.

```csharp
app.MapGet("/todoitems2", async (TodoDb db) => await db.Todos.ToListAsync())
    .WithOpenApi(operation => new(operation)
    {
        Summary = "This is a summary",
        Description = "This is a description"
    });
```

### Exclude Open API description

In the following sample, the `/skipme` endpoint is excluded from generating an OpenAPI description:

[!code-csharp[](7.0-samples/WebMinAPIs/Program.cs?name=snippet_swag2&highlight=20-21)]

### Mark an API as obsolete

To mark an endpoint as obsolete, set the `Deprecated` property on the OpenAPI annotation.

```csharp
app.MapGet("/todos", async (TodoDb db) => await db.Todos.ToListAsync())
    .WithOpenApi(operation => new(operation)
    {
        Deprecated = true
    });
```

### Describe response types

OpenAPI supports providing a description of the responses returned from an API. Minimal APIs supports three strategies for setting the response type of an endpoint:

* Via the `Produces` extension method
* Via the `ProducesResponseType` attribute
* By returning `TypedResults` from your application

The `Produces` extension method can be used to add `Produces` metadata to an endpoint. When no parameters are provided, the extension method will populate metadata for the targeted type under a `200` status code and an `application/json` content type.

```csharp
app
    .MapGet("/todos", async (TodoDb db) => await db.Todos.ToListAsync())
    .Produces<IList<Todo>>();
```

Leveraging `TypedResults` in the implementation of an endpoint's route handler will automatically include the response type metadata for the endpoint. For example, the code below will automatically annotate the endpoint with a response under the `200` status code with an `application/json` content type.

```csharp
app.MapGet("/todos", async (TodoDb db) =>
{
    var todos = await db.Todos.ToListAsync());
    return TypedResults.Ok(todos);
});
```

#### Set responses for ProblemDetails

When setting the response type for endpoints that may return a ProblemDetails response, the [`ProducesProblem`](/dotnet/api/microsoft.aspnetcore.http.openapiroutehandlerbuilderextensions.producesproblem) extension method or [`TypeResults.Problem`](/dotnet/api/microsoft.aspnetcore.http.typedresults.problem?) can be used to add the appropriate annotation to the endpoint's metadata.

When there are no explicit annotations provided by one of the strategies above, the framework will attempt to determine a default response type by examining the signature of the response. This default response will be populated under the `200` status code in the OpenAPI definition.

### Describe request body and parameters

In addition to describing the types that are returned by an endpoint, OpenAPI also supports annotating the inputs that are consumed by an API. These inputs fall into two categories:

* Parameters that appear in the path, query string, headers, or cookies
* Data transmitted as part of the request body

The framework will infer the types for request parameters in the path, query, and header string automatically based on the signature of the route handler.

To define the type of inputs transmitted as the request body, you can configure the properties by using the `Accepts` extension method to define the object type and content type that are expected by the request handler.

```csharp
app.MapPost("/todos/{id}", (int id, Todo todo) => ...)
  .Accepts<Todo>();
```

When there is no explicit annotation provide, the framework will attempt to determine the default request type if there exists a request body parameter in the endpoint handler. 

### Support API versioning

Minimal APIs supports API versioning via the [Asp.Versioning.Http package](https://www.nuget.org/packages/Asp.Versioning.Http). Examples of configuring versioning with minimal APIs can be found in [the API versioning repo](https://github.com/dotnet/aspnet-api-versioning/tree/3857a332057d970ad11bac0edfdbff8a559a215d/examples/AspNetCore/WebApi).

<!-- 
# Differences between minimal APIs and APIs with controllers

Moved to uid: tutorials/min-web-api
-->

### ASP.NET Core OpenAPI source code on GitHub

* [WithOpenApi](https://github.com/dotnet/aspnetcore/blob/8a4b4deb09c04134f22f8d39aae21d212282004f/src/OpenApi/src/OpenApiRouteHandlerBuilderExtensions.cs)
* [OpenApiGenerator](https://github.com/dotnet/aspnetcore/blob/main/src/OpenApi/src/OpenApiGenerator.cs)

:::moniker-end
